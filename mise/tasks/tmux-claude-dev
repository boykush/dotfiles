#!/bin/bash
#MISE description="Start tmux with Claude Code + helix preview pane"
#MISE dir="{{cwd}}"

# Session name based on repository directory name
REPO_NAME=$(basename "$(pwd)")
SESSION_NAME="claude-dev-${REPO_NAME}"

# If session already exists, attach to it
if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    tmux attach-session -t "$SESSION_NAME"
    exit 0
fi

# Create new tmux session with claude in the first pane
tmux new-session -d -s "$SESSION_NAME" -c "$(pwd)" "claude"

# Split and open helix in the right pane (upper)
tmux split-window -h -t "$SESSION_NAME" -c "$(pwd)" "hx"

# Split right pane vertically for gitui (lower right)
tmux split-window -v -t "$SESSION_NAME":0.1 -c "$(pwd)" "gitui"

# Split left pane vertically for free terminal (lower left)
tmux split-window -v -t "$SESSION_NAME":0.0 -c "$(pwd)"

# Focus the left upper pane (claude)
tmux select-pane -t "$SESSION_NAME":0.0

# Attach to the session
tmux attach-session -t "$SESSION_NAME"
